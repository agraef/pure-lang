<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.6: http://docutils.sourceforge.net/" />
<title>pure-faust: Run Faust programs in Pure scripts</title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 5631 2008-08-24 13:01:23Z goodger $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left {
  clear: left }

img.align-right {
  clear: right }

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block {
  margin-left: 2em ;
  margin-right: 2em }

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document" id="pure-faust-run-faust-programs-in-pure-scripts">
<h1 class="title">pure-faust: Run Faust programs in Pure scripts</h1>

<p>This module lets you load and run Faust-generated signal processing modules in
<a class="reference external" href="http://pure-lang.googlecode.com/">Pure</a>. <a class="reference external" href="http://faust.grame.fr/">Faust</a> (an acronym for Functional AUdio STreams) is a functional
programming language for real-time sound processing and synthesis developed at
<a class="reference external" href="http://www.grame.fr/">Grame</a> and distributed as GPL'ed software.</p>
<div class="section" id="copying">
<h1>Copying</h1>
<p>Unless explicitly stated otherwise, this software is Copyright (c) 2009 by
Albert Graef. Please also see the source for the copyright and license notes
pertaining to individual source files.</p>
<p>pure-faust is free software: you can redistribute it and/or modify it under
the terms of the GNU Lesser General Public License as published by the Free
Software Foundation, either version 3 of the License, or (at your option) any
later version.</p>
<p>pure-faust is distributed in the hope that it will be useful, but WITHOUT ANY
WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR
A PARTICULAR PURPOSE.  See the GNU Lesser General Public License for more
details.</p>
<p>You should have received a copy of the GNU Lesser General Public License along
with this program.  If not, see &lt;<a class="reference external" href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>&gt;.</p>
</div>
<div class="section" id="installation">
<h1>Installation</h1>
<p>Binary packages can be found at <a class="reference external" href="http://pure-lang.googlecode.com/">http://pure-lang.googlecode.com/</a>. To install
from source, run the usual <tt class="docutils literal"><span class="pre">make</span> <span class="pre">&amp;&amp;</span> <span class="pre">sudo</span> <span class="pre">make</span> <span class="pre">install</span></tt>. This requires Pure,
of course. The Makefile tries to guess the installation prefix under which
Pure is installed. If it guesses wrong, you can tell it the right prefix with
<tt class="docutils literal"><span class="pre">make</span> <span class="pre">prefix=/some/path</span></tt>. Or you can specify the exact path of the
<tt class="docutils literal"><span class="pre">lib/pure</span></tt> directory with <tt class="docutils literal"><span class="pre">make</span> <span class="pre">libdir=/some/path</span></tt>; by default the
Makefile assumes <tt class="docutils literal"><span class="pre">$(prefix)/lib/pure</span></tt>. The Makefile also tries to guess the
host system type and set up some platform-specific things accordingly. If this
doesn't work for your system then you'll have to edit the Makefile
accordingly.</p>
<p>The Faust compiler is not required to compile this module, but of course
you'll need it to build the examples in the <tt class="docutils literal"><span class="pre">examples</span></tt> subdirectory and to
compile your own Faust sources. You'll need Faust 0.9.9.6 or later.</p>
<p>To compile Faust programs for use with this module, you'll also need the
<tt class="docutils literal"><span class="pre">pure.cpp</span></tt> architecture file. This should be included in recent Faust
releases. If your Faust version doesn't have it yet, you can find a suitable
version of this file in the <tt class="docutils literal"><span class="pre">examples</span></tt> folder. Simply copy the file to your
Faust library directory (usually <tt class="docutils literal"><span class="pre">/usr/local/lib/faust</span></tt> or similar) or the
directory holding the Faust sources to be compiled, and you should be set.
(Note that <tt class="docutils literal"><span class="pre">pure.cpp</span></tt> is distributed under a simple all-permissive license,
so you can use it for pretty much any purpose, including commercial
applications.)</p>
</div>
<div class="section" id="usage">
<h1>Usage</h1>
<p>Once Faust and this module have been installed as described above, you should
be able to compile a Faust DSP to a shared module loadable by pure-faust as
follows:</p>
<pre class="literal-block">
$ faust -a pure.cpp -o mydsp.cpp mydsp.dsp
$ g++ -shared -o mydsp.so mydsp.cpp
</pre>
<p>Note that, by default, Faust generates code which does all internal
computations with single precision. You can add the <tt class="docutils literal"><span class="pre">-double</span></tt> flag to the
Faust command in order to use double precision instead. (In either case, all
data will be represented as doubles on the Pure side.)</p>
<p>Also note that the above compile command is for a Linux or BSD system using
<tt class="docutils literal"><span class="pre">gcc</span></tt>. Add <tt class="docutils literal"><span class="pre">-fPIC</span></tt> for 64 bit compilation. For Windows compilation, the
output filename should be <tt class="docutils literal"><span class="pre">mydsp.dll</span></tt> instead of <tt class="docutils literal"><span class="pre">mydsp.so</span></tt>; on Mac OSX,
it should be <tt class="docutils literal"><span class="pre">mydsp.dylib</span></tt>. There's a Makefile in the <tt class="docutils literal"><span class="pre">examples</span></tt> folder
which automates this process.</p>
<p>Once the module has been compiled, you can fire up the Pure interpreter and
load the DSP as follows:</p>
<pre class="literal-block">
&gt; using faust;
&gt; let dsp = faust_init &quot;mydsp&quot; 48000;
&gt; dsp;
#&lt;pointer 0xf09220&gt;
</pre>
<p>The <tt class="docutils literal"><span class="pre">faust_init</span></tt> function loads the <tt class="docutils literal"><span class="pre">&quot;mydsp.so&quot;</span></tt> module (the <tt class="docutils literal"><span class="pre">.so</span></tt>
suffix is supplied automatically) and returns a pointer to the Faust DSP
object which can then be used in subsequent operations. The second parameter
of <tt class="docutils literal"><span class="pre">faust_init</span></tt>, 48000 in this example, denotes the sample rate in Hz. This
can be an arbitrary integer value which is available to the hosted DSP (it's
up to the DSP whether it actually uses this value in some way). The sample
rate can also be changed on the fly with the <tt class="docutils literal"><span class="pre">faust_reinit</span></tt> function:</p>
<pre class="literal-block">
&gt; faust_reinit dsp 44100;
</pre>
<p>It is also possible to create copies of an existing DSP with the
<tt class="docutils literal"><span class="pre">faust_clone</span></tt> function, which is quite handy if multiple copies of the same
DSP are needed (a case which commonly arises when implementing polyphonic
synthesizers):</p>
<pre class="literal-block">
&gt; let dsp2 = faust_clone dsp;
</pre>
<p>When you're done with a DSP, you can invoke the <tt class="docutils literal"><span class="pre">faust_exit</span></tt> function to
unload it (this also happens automatically when a DSP object is
garbage-collected):</p>
<pre class="literal-block">
&gt; faust_exit dsp2;
</pre>
<p>Note that after invoking this operation the DSP pointer becomes invalid and
must not be used any more.</p>
<p>The <tt class="docutils literal"><span class="pre">faust_info</span></tt> function can be used to determine the number of
input/output channels as well as the &quot;UI&quot; (a data structure describing the
available control variables) of the loaded DSP:</p>
<pre class="literal-block">
&gt; let n,m,ui = faust_info dsp;
</pre>
<p>To actually run the DSP, you'll need two buffers capable of holding the
required number of audio samples for input and output. For convenience, the
<tt class="docutils literal"><span class="pre">faust_compute</span></tt> routine lets you specify these as Pure double matrices.
<tt class="docutils literal"><span class="pre">faust_compute</span></tt> is invoked as follows:</p>
<pre class="literal-block">
&gt; faust_compute dsp in out;
</pre>
<p>Here, <tt class="docutils literal"><span class="pre">in</span></tt> and <tt class="docutils literal"><span class="pre">out</span></tt> must be double matrices of the same row size (which
corresponds to the number of samples which will be processed) which have at
least <tt class="docutils literal"><span class="pre">n</span></tt> or <tt class="docutils literal"><span class="pre">m</span></tt> rows, respectively (corresponding to the number of input
and output channels of the Faust DSP). The <tt class="docutils literal"><span class="pre">out</span></tt> matrix will be modified
in-place and also returned as the result of the call.</p>
<p>Some DSPs (e.g., synthesizers) only take control input without processing any
audio input; others (e.g., pitch detectors) might produce just control output
without any audio output. In such cases you can just specify an empty <tt class="docutils literal"><span class="pre">in</span></tt>
or <tt class="docutils literal"><span class="pre">out</span></tt> matrix, respectively. For instance:</p>
<pre class="literal-block">
&gt; faust_compute dsp {} out;
</pre>
<p>Most DSPs take additional control input. The control variables are listed in
the &quot;UI&quot; component of the faust_info return value. For instance, suppose that
there's a <tt class="docutils literal"><span class="pre">gain</span></tt> parameter listed there, it might look as follows:</p>
<pre class="literal-block">
&gt; controls ui!0;
hslider #&lt;pointer 0x12780a4&gt; (&quot;gain&quot;,1.0,0.0,10.0,0.1)
</pre>
<p>The constructor itself denotes the type of control, which matches the name of
the Faust builtin used to create the control (see the Faust documentation for
more details on this). The second parameter is a tuple which indicates the
arguments the control was created with in the Faust program. The first
parameter is a C <tt class="docutils literal"><span class="pre">double*</span></tt> which points to the current value of the control
variable. You can inspect and change this value with the <tt class="docutils literal"><span class="pre">get_double</span></tt> and
<tt class="docutils literal"><span class="pre">put_double</span></tt> routines available in the Pure prelude. (Note that changes of
control variables only take effect between different invokations of
<tt class="docutils literal"><span class="pre">faust_compute</span></tt>.) Example:</p>
<pre class="literal-block">
&gt; let gain = control_ref (controls ui!0);
&gt; get_double gain;
1.0
&gt; put_double gain 2.0;
()
&gt; faust_compute dsp in out;
</pre>
<p>Output controls such as <tt class="docutils literal"><span class="pre">hbargraph</span></tt> and <tt class="docutils literal"><span class="pre">vbargraph</span></tt> are handled in a
similar fashion, only that the Faust DSP updates these values for each call to
<tt class="docutils literal"><span class="pre">faust_compute</span></tt> and Pure scripts can then read the values with <tt class="docutils literal"><span class="pre">get_double</span></tt>.</p>
<p>Ok, I hope that this is enough to get you started. Further examples can be
found in the examples subdirectory. Please send bug reports, patches, comments
and suggestions to: <a class="reference external" href="mailto:Dr.Graef&#64;t-online.de">Dr.Graef&#64;t-online.de</a>.</p>
</div>
<div class="section" id="acknowledgements">
<h1>Acknowledgements</h1>
<p>Many thanks to Yann Olarey at Grame, the principal author of Faust!</p>
<!-- Enjoy. :) -->
<!-- Albert Graef <Dr.Graef@t-online.de> -->
</div>
</div>
</body>
</html>
